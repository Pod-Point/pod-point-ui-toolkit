<!DOCTYPE html>
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE 9]><!--> <html lang="en"> <!--<![endif]-->
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" id="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0" />

	<title> - </title>

	<link href="assets/css/styles.css" rel="stylesheet">
	<link href="assets/css/demo.css" rel="stylesheet">



	<!--Start of Zendesk Chat Script-->
	<script type="text/javascript">
	window.$zopim||(function(d,s){var z=$zopim=function(c){z._.push(c)},$=z.s=
	d.createElement(s),e=d.getElementsByTagName(s)[0];z.set=function(o){z.set.
	_.push(o)};z._=[];z.set._=[];$.async=!0;$.setAttribute("charset","utf-8");
	$.src="https://v2.zopim.com/?49vIu3qscYr2sp40IjcXOg8ypK3xwFRh";z.t=+new Date;$.
	type="text/javascript";e.parentNode.insertBefore($,e)})(document,"script");
	</script>
	<!--End of Zendesk Chat Script-->
</head>
<body>

	<img class="svg hidden" src="assets/svg/symbol/svg/sprite.symbol.svg" alt="">

	<!--[if lt IE 9]>
		<div class="browsehappy">
			<p>You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
		</div>
	<![endif]-->

	<div class="global-wrapper">
		<header role="header" class="demo-header">
			<div class="container">
				<a class="demo-logo-main" href="/">
					<img src="assets/img/pod-point-logo.svg" alt="POD Point">
				</a>
			</div>
		</header><div data-page="gallery-simple">
	<header class="demo-section-heading">
		<div class="container content-block">
			<h2>Gallery simple</h2>
		</div>
	</header>

	<section class="container content-block">
		<div class="gallery-simple marg-center" data-js-module="gallerySimple">
			<img class="gallery-simple__image" src="">
			<ul class="gallery-simple__thumbnails">
				<li><a href="#"><img src="assets/img/content/podpoint-homecharge-gallery-item-one.png"></a></li>
				<li><a href="#"><img src="assets/img/content/podpoint-homecharge-gallery-item-two.jpg"></a></li>
				<li><a href="#"><img src="assets/img/content/podpoint-homecharge-gallery-item-three.jpg"></a></li>
				<li><a href="#"><img src="assets/img/content/podpoint-homecharge-gallery-item-four.jpg"></a></li>
			</ul>
		</div>	</section>
</div>

	</div>

	<script src="assets/js/script.js"></script>

	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script src="https://d3js.org/queue.v1.min.js"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
	<script src="assets/js/data/chargeData.js"></script>
	<script src="assets/js-plugins/gridmap.js"></script>

	<script>
		var mapElement = document.querySelector("#gridmap");
		var markerHolder = document.getElementById('markerHolder');

		if (mapElement) {
			var timeDelay = 3500; // time in milliseconds between new charges appearing on the map
			var mapWidth = 460;
			var mapHeight = 267; // these values set the physical size of the map on the page
			var mapDotStepSize = 6; // this sets size of the map dots
			var mapLonLeft = -10.65; // enter the longitude in degrees on left edge of map, by comparing with Google Maps
			var mapLonRight = 20.01; // enter the longitude in degrees on right edge of map
			var mapLatBottom = 49.3; // enter the latitude in degrees on bottom edge of map
			var lastHighlightedDot = [];

			// these values set scale and boundaries of the map
			var s = 1342, t = [168, 1382];

			var projection = d3.geo.azimuthalEqualArea().scale(s).translate(t).clipAngle(180).precision(1),
	        path = d3.geo.path().projection(projection);

			queue()
				.defer(d3.json, "assets/js/data/geo-data/eu.json")
				.await(ready);

			getRandomInt = function(min, max) {
				return Math.floor(Math.random() * (max - min + 1)) + min
			}

			function ready(error, eu) {
				// var features =  topojson.feature(us, us.objects.counties).features;
				var features =  topojson.feature(eu, eu.objects.europe).features;
				// generate some random data
				var data = d3.map(); // data is a d3.map !!
				var j;
				for (j = 0, len = features.length; j < len; j++) {
					data.set(features[j]["id"], getRandomInt(1,5));
				}

				chart = new gridmap()
					.data(data)
					.width(mapWidth)
					.height(mapHeight)
					.key("id")
					.side(mapDotStepSize) // change this to make dots larger or smaller
					.isDensity(true)
					.projection(projection)
					.features(features)
					.fill("#CCCCCC");

				d3.select("#gridmap").call(chart);
			}

			function showMarker(x, y, kw, saving) {
				var lastHighlightedDot = [x, y];
				var mapPoint = document.querySelectorAll('circle[cx="' + x + '"][cy="' + y + '"]');

				if (mapPoint.length) {
					mapPoint[0].classList.add('gridmap-dot-selected');
					var kwText = document.getElementById('kw');
					kwText.innerHTML = kw;

					savingText = document.getElementById('saving');
					savingText.innerHTML = saving;

					markerHolder.style.left = (x - 32) + 'px';
					markerHolder.style.top = (y - 32) + 'px';
					markerHolder.style.visibility = 'visible';
					markerHolder.classList.add('bulge-appear');
				} else {
					nextCharge();
				}
			}

			function hideMarker() {
				if (lastHighlightedDot[0]) {
					mapPoint = document.querySelectorAll('circle[cx="' + lastHighlightedDot[0] + '"][cy="' + lastHighlightedDot[1] + '"]');
					if (mapPoint.length) {
						mapPoint[0].classList.remove('gridmap-dot-selected');
					}
				}
				markerHolder.classList.remove('bulge-appear');
				markerHolder.style.visibility = 'hidden';
				void markerHolder.offsetWidth; // workaround to force browser to reflow so bulge animation class works again next time
				lastHighlightedDot = [];
			}

			Number.prototype.roundTo = function(num) {
				var resto = this%num;
				if (resto <= (num/2)) {
					return this-resto;
				} else {
					return this+num-resto;
				}
			}

			// adapted from http://stackoverflow.com/a/27313080
			function convertLatLongToDot(latitude, longitude) {
				var mapLonDelta = mapLonRight - mapLonLeft;
				var mapLatBottomDegree = mapLatBottom * Math.PI / 180;
				var x = (longitude - mapLonLeft) * (mapWidth / mapLonDelta);
				latitude = latitude * Math.PI / 180;
				var worldMapWidth = ((mapWidth / mapLonDelta) * 360) / (2 * Math.PI);
				var mapOffsetY = (worldMapWidth / 2 * Math.log((1 + Math.sin(mapLatBottomDegree)) / (1 - Math.sin(mapLatBottomDegree))));
				var y = mapHeight - ((worldMapWidth / 2 * Math.log((1 + Math.sin(latitude)) / (1 - Math.sin(latitude)))) - mapOffsetY);
				var dotX = x.roundTo(mapDotStepSize);
				var dotY = y.roundTo(mapDotStepSize);

				return [dotX, dotY];
			}

			function showChargeOnMap(latitude, longitude, kw, saving) {
				var dotCoords = convertLatLongToDot(latitude, longitude);
				showMarker(dotCoords[0], dotCoords[1], kw, saving);
			}

			function nextCharge() {
				hideMarker();
				var charge = chargesData[Math.floor(Math.random() * chargesData.length)];
				showChargeOnMap(charge[0], charge[1], charge[2], charge[3]);
			}

			// setInterval(nextCharge, timeDelay);

		}
</script>

</body>
</html>
